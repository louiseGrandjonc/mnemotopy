{% extends "mnemotopy/project/edit/base.html" %}
{% load i18n %}
{% load static %}

{% block title %}
    {% if form.instance.pk %}
       {% trans 'Update Project' %}
    {% else %}
        {% trans 'Create Project' %}
    {% endif %}
{% endblock %}

{% block head_js %}
    <script src="{% static 'js/jquery.js' %}"></script>
    <script type="text/javascript" src="{% static "js/formset.js" %}"></script>
{% endblock %}

{% block main %}
    <h1 class="project__title">
        {% trans 'Edit project slideshow' %}
    </h1>
    <form method="post" id="submit-form" enctype="multipart/form-data">
        {% csrf_token %}

        {% with formset=form %}
            <div class="formset media-form-multiple item-formset">
                {{ formset.management_form }}

                {% for form in formset %}
                    {% with form=form %}
                        {% include "mnemotopy/project/edit/media/_item.html" %}
                    {% endwith %}
                {% endfor %}
            </div>
            {{ formset.non_form_errors }}
            <div class="add-media">
                <a class="media-add-btn" href="#" ><i class="icon icon-plus"></i>{% trans "Add a media" %}</a>
            </div>
        {% endwith %}
    </form>
{% endblock %}

{% block extend_js %}
    {{ block.super }}

    <script type="text/javascript">
     $(document).ready(function() {
         function toggleFields(input) {
             var current_form = $(input).parents('.shutter__content');
             console.log($(input).val());
             if ($(input).val() == 0) {
                 current_form.find('.image-field').show();
                 current_form.find('.video-field').hide();
                 current_form.find('.audio-field').hide();
                 current_form.find('.thumbnail-file-field').hide();
             }

             if ($(input).val() == 1) {
                 current_form.find('.image-field').hide();
                 current_form.find('.video-field').show();
                 current_form.find('.audio-field').hide();
                 current_form.find('.thumbnail-file-field').show();
             }

             if ($(input).val() == 2) {
                 current_form.find('.image-field').hide();
                 current_form.find('.video-field').hide();
                 current_form.find('.audio-field').show();
                 current_form.find('.thumbnail-file-field').show();
             }

         }

         $(document)
                .on('click', '.media-add-btn', function(e) {
                    e.preventDefault();
                    var form = $('.formset');
                    var formset = new FormSet(form),
                        count = formset.count(),
                        currentLast = form.find('.item').last();
                    var newRow = formset.add();
                })
                .on('click', '.media-delete-btn', function(e) {
                    e.preventDefault();
                    var form = $('.formset'),
                        formset = new FormSet(form);
                    formset.remove($(e.target));
                })
                .on('change', '.radio-type', function(e) {
                    console.log($(this).val());
                    toggleFields(this);
                });

         $('.radio-type:checked').each(function(){
             toggleFields(this);
         });

     });
    </script>

{% endblock %}
